- name: Send with SendGrid
  run: |
    # HTML内容を読み込み＆安全な文字列に変換（ダブルクオートなども対応）
    html=$(< email.html)
    escaped_html=$(printf '%s\n' "$html" | jq -Rs .)

    cat <<EOF > payload_ready.json
{
  "personalizations": [
    {
      "to": [
        { "email": "jun.sasaki.eidendo@gmail.com" }
      ],
      "subject": "【2112】週刊 Road to 2112"
    }
  ],
  "from": {
    "email": "info@sassamahha.me",
    "name": "Jun Sasaki"
  },
  "content": [
    {
      "type": "text/html",
      "value": $escaped_html
    }
  ]
}
EOF

    # Debug log（任意）
    echo "------ SENDGRID PAYLOAD ------"
    cat payload_ready.json
    echo "------------------------------"

    curl -s --request POST \
      --url https://api.sendgrid.com/v3/mail/send \
      --header "Authorization: Bearer $SENDGRID_API_KEY" \
      --header "Content-Type: application/json" \
      --data @payload_ready.json
  env:
    SENDGRID_API_KEY: ${{ secrets.SENDGRID_API_KEY }}
